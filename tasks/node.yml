---
- name: Install nodejs and npm
  become: true
  ansible.builtin.apt:
    name: [nodejs, npm]
  tags: &tags [install, node]

- name: Create .npm-global directory
  ansible.builtin.file:
    path: ~/.local/.npm-global
    state: directory
    mode: "0755"
  tags: *tags

- name: Add npm to path
  ansible.builtin.shell: PATH=~/.local/.npm-global/bin:$PATH
  changed_when: false
  tags: *tags

- name: Npm global settings
  ansible.builtin.command: npm config set prefix '~/.local/.npm-global'
  changed_when: false
  tags: *tags

- name: Download nvm
  ansible.builtin.get_url:
    url: https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh
    dest: ~/.nvm-installer
    mode: a+x
  tags: *tags

- name: Install nvm
  ansible.builtin.shell: ~/.nvm-installer && rm -rf ~/.nvm-installer
  changed_when: false
  tags: *tags
# TODO: Should fix this!
# - name: Install version 16 of Node
#   shell: source ~/.bashrc && nvm install 16.16.0 && nvm alias default 16.16.0 && nvm use --delete-prefix v16.16.0 --silent
#   tags: *tags
